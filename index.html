<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>График работы 3 через 1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: linear-gradient(135deg, #ffb6c1 0%, #ffc0cb 50%, #ffe4e1 100%);
            --bg-container: white;
            --bg-header: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            --bg-controls: linear-gradient(135deg, #ffe4e1 0%, #fff0f5 100%);
            --bg-info: linear-gradient(135deg, #ffe4e1 0%, #fff0f5 100%);
            --bg-legend: linear-gradient(135deg, #ffe4e1 0%, #fff0f5 100%);
            --text-primary: #8b4513;
            --text-secondary: #333;
            --text-info: #666;
            --border-color: #ffb6c1;
            --day-bg: white;
            --day-border: #ffe4e1;
            --other-month-bg: #f8f9fa;
            --other-month-text: #6c757d;
            --today-bg: #ffe4e1;
            --today-border: #ff9a9e;
        }

        [data-theme="dark"] {
            --bg-primary: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --bg-container: #1a202c;
            --bg-header: linear-gradient(135deg, #2d3748 0%, #4a5568 50%, #4a5568 100%);
            --bg-controls: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            --bg-info: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            --bg-legend: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            --text-primary: #e2e8f0;
            --text-secondary: #f7fafc;
            --text-info: #cbd5e0;
            --border-color: #4a5568;
            --day-bg: #2d3748;
            --day-border: #4a5568;
            --other-month-bg: #1a202c;
            --other-month-text: #718096;
            --today-bg: #2b6cb0;
            --today-border: #3182ce;
        }

        /* Анимированные звезды для темной темы */
        [data-theme="dark"] body::before {
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.8) 1px, transparent 1px),
                radial-gradient(circle at 80% 40%, rgba(255, 255, 255, 0.6) 1px, transparent 1px),
                radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.4) 1px, transparent 1px),
                radial-gradient(circle at 60% 10%, rgba(255, 255, 255, 0.9) 1px, transparent 1px),
                radial-gradient(circle at 10% 70%, rgba(255, 255, 255, 0.5) 1px, transparent 1px),
                radial-gradient(circle at 90% 90%, rgba(255, 255, 255, 0.7) 1px, transparent 1px) !important;
            background-size: 200px 200px, 300px 300px, 250px 250px, 180px 180px, 220px 220px, 280px 280px !important;
            animation: twinkle 4s ease-in-out infinite alternate !important;
        }

        @keyframes twinkle {
            0% {
                opacity: 0.3;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.1);
            }
            100% {
                opacity: 0.5;
                transform: scale(0.9);
            }
        }

        /* Дополнительные мерцающие звезды */
        [data-theme="dark"] body::after {
            content: '' !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background-image: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3) 0.5px, transparent 0.5px),
                radial-gradient(circle at 70% 20%, rgba(255, 255, 255, 0.2) 0.5px, transparent 0.5px),
                radial-gradient(circle at 50% 60%, rgba(255, 255, 255, 0.4) 0.5px, transparent 0.5px),
                radial-gradient(circle at 15% 85%, rgba(255, 255, 255, 0.3) 0.5px, transparent 0.5px),
                radial-gradient(circle at 85% 15%, rgba(255, 255, 255, 0.2) 0.5px, transparent 0.5px) !important;
            background-size: 150px 150px, 200px 200px, 180px 180px, 160px 160px, 190px 190px !important;
            animation: sparkle 3s ease-in-out infinite alternate !important;
            pointer-events: none !important;
            z-index: -1 !important;
        }

        @keyframes sparkle {
            0% {
                opacity: 0.1;
                transform: rotate(0deg) scale(0.8);
            }
            50% {
                opacity: 0.6;
                transform: rotate(180deg) scale(1.2);
            }
            100% {
                opacity: 0.2;
                transform: rotate(360deg) scale(0.9);
            }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            transition: background 0.3s ease;
        }

        /* Светлая тема - простые точки */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.1) 2px, transparent 2px),
                radial-gradient(circle at 80% 40%, rgba(255, 255, 255, 0.1) 2px, transparent 2px),
                radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.1) 2px, transparent 2px);
            background-size: 100px 100px, 150px 150px, 120px 120px;
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-container);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: background 0.3s ease;
        }

        .header {
            background: var(--bg-header);
            color: var(--text-primary);
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }


        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.5);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .controls {
            padding: 20px;
            background: var(--bg-controls);
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            position: relative;
            transition: background 0.3s ease, border-color 0.3s ease;
        }


        .date-input {
            padding: 10px 15px;
            border: 2px solid #ff9a9e;
            border-radius: 20px;
            font-size: 16px;
            outline: none;
            background: var(--bg-container);
            color: var(--text-secondary);
            box-shadow: 0 4px 8px rgba(255, 154, 158, 0.2);
            transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        /* Темная тема для полей ввода */
        [data-theme="dark"] .date-input {
            border-color: #4a5568;
            background: #2d3748;
            color: #e2e8f0;
            box-shadow: 0 4px 8px rgba(74, 85, 104, 0.2);
        }

        [data-theme="dark"] .date-input:focus {
            border-color: #63b3ed;
            box-shadow: 0 4px 12px rgba(99, 179, 237, 0.3);
        }

        .date-input:focus {
            border-color: #ff6b9d;
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.3);
        }

        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #8b4513;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(255, 154, 158, 0.3);
        }

        /* Темная тема для кнопок */
        [data-theme="dark"] .btn {
            background: linear-gradient(135deg, #4a5568 0%, #718096 100%);
            color: #e2e8f0;
            box-shadow: 0 4px 8px rgba(74, 85, 104, 0.3);
        }

        [data-theme="dark"] .btn:hover {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            box-shadow: 0 6px 12px rgba(45, 55, 72, 0.4);
        }

        .btn:hover {
            background: linear-gradient(135deg, #ff6b9d 0%, #ff9a9e 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255, 107, 157, 0.4);
        }

        /* Кнопка сброса */
        .btn-reset {
            background: linear-gradient(135deg, #e53e3e 0%, #fc8181 100%) !important;
            color: white !important;
            box-shadow: 0 4px 8px rgba(229, 62, 62, 0.3) !important;
        }

        .btn-reset:hover {
            background: linear-gradient(135deg, #c53030 0%, #e53e3e 100%) !important;
            box-shadow: 0 6px 12px rgba(197, 48, 48, 0.4) !important;
        }

        /* Космическая кнопка переключения темы */
        .theme-toggle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%) !important;
            color: white !important;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4) !important;
        }

        .theme-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .theme-toggle:hover::before {
            left: 100%;
        }

        .theme-toggle:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 50%, #ec4899 100%) !important;
            box-shadow: 0 6px 20px rgba(90, 103, 216, 0.6) !important;
            transform: translateY(-2px);
        }

        /* Темная тема для космической кнопки */
        [data-theme="dark"] .theme-toggle {
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 50%, #ff4500 100%) !important;
            color: #1a1a2e !important;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4) !important;
        }

        [data-theme="dark"] .theme-toggle:hover {
            background: linear-gradient(135deg, #ffed4e 0%, #ffa500 50%, #ff6347 100%) !important;
            box-shadow: 0 6px 20px rgba(255, 237, 78, 0.6) !important;
        }

        .calendar {
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        /* Анимации для календаря (оптимизированные) */
        .calendar-grid {
            will-change: transform, opacity;
            transform: translateZ(0); /* Включаем аппаратное ускорение */
        }

        .calendar-slide-in-right {
            animation: slideInFromRight 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .calendar-slide-in-left {
            animation: slideInFromLeft 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .calendar-slide-out-right {
            animation: slideOutToRight 0.6s cubic-bezier(0.55, 0.06, 0.68, 0.19);
        }

        .calendar-slide-out-left {
            animation: slideOutToLeft 0.6s cubic-bezier(0.55, 0.06, 0.68, 0.19);
        }

        .calendar-fade-in {
            animation: fadeIn 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .calendar-fade-out {
            animation: fadeOut 0.5s cubic-bezier(0.55, 0.06, 0.68, 0.19);
        }

        @keyframes slideInFromRight {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideInFromLeft {
            0% {
                transform: translateX(-100%);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutToRight {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes slideOutToLeft {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-100%);
                opacity: 0;
            }
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(1.1);
            }
        }

        /* Анимация для дней (оптимизированная) */
        .day {
            will-change: transform;
            transition: transform 0.3s ease;
        }

        .day:hover {
            transform: scale(1.02) translateY(-1px);
        }

        /* Анимация для заголовка месяца */
        .month-title {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .month-title-update {
            animation: titleUpdate 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes titleUpdate {
            0% {
                transform: scale(1);
                color: var(--text-secondary);
            }
            50% {
                transform: scale(1.1);
                color: #ff6b9d;
            }
            100% {
                transform: scale(1);
                color: var(--text-secondary);
            }
        }

        .month-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 20px;
        }

        .month-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .nav-btn {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #8b4513;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(255, 154, 158, 0.3);
        }

        /* Темная тема для навигационных кнопок */
        [data-theme="dark"] .nav-btn {
            background: linear-gradient(135deg, #4a5568 0%, #718096 100%);
            color: #e2e8f0;
            box-shadow: 0 4px 8px rgba(74, 85, 104, 0.3);
        }

        [data-theme="dark"] .nav-btn:hover {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            box-shadow: 0 6px 12px rgba(45, 55, 72, 0.4);
        }

        .nav-btn:hover {
            background: linear-gradient(135deg, #ff6b9d 0%, #ff9a9e 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255, 107, 157, 0.4);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            width: 100%;
            max-width: 100%;
            min-width: 0; /* Позволяет сжиматься */
        }

        .day-header {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #8b4513;
            padding: 15px 10px;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            border-bottom: 2px solid #ffb6c1;
            min-width: 0; /* Позволяет сжиматься */
            overflow: hidden; /* Скрывает переполнение */
        }

        /* Темная тема для заголовков дней */
        [data-theme="dark"] .day-header {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            color: #e2e8f0;
            border-bottom: 2px solid #4a5568;
        }

        .day {
            background: var(--day-bg);
            color: var(--text-secondary);
            padding: 15px 10px;
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: all 0.3s ease;
            border: 1px solid var(--day-border);
            min-width: 0; /* Позволяет сжиматься */
            overflow: hidden; /* Скрывает переполнение */
        }

        .day:hover {
            background: #fff0f5;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(255, 154, 158, 0.2);
        }

        .day-number {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .day-status {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: bold;
        }

        .work-day, .work-1, .work-2, .work-3 {
            border: 2px solid #32CD32;
            font-weight: bold;
        }

        .work-1 {
            background: linear-gradient(135deg, #90EE90 0%, #98FB98 100%);
            color: #2d5016;
        }

        .work-2 {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #8B4513;
        }

        .work-3 {
            background: linear-gradient(135deg, #FF6347 0%, #FF4500 100%);
            color: #8B0000;
        }

        .off-day {
            background: linear-gradient(135deg, #FFB6C1 0%, #FFC0CB 100%);
            color: #8b0000;
            border: 2px solid #DC143C;
        }

        /* Темная тема для рабочих дней */
        [data-theme="dark"] .work-1 {
            background: linear-gradient(135deg, #2d5a2d 0%, #3d6b3d 100%);
            color: #a8d5a8;
            border: 2px solid #4a7c4a;
        }

        [data-theme="dark"] .work-2 {
            background: linear-gradient(135deg, #5a4a2d 0%, #6b5a3d 100%);
            color: #d5c4a8;
            border: 2px solid #7c6a4a;
        }

        [data-theme="dark"] .work-3 {
            background: linear-gradient(135deg, #5a2d2d 0%, #6b3d3d 100%);
            color: #d5a8a8;
            border: 2px solid #7c4a4a;
        }

        [data-theme="dark"] .off-day {
            background: linear-gradient(135deg, #4a2d4a 0%, #5a3d5a 100%);
            color: #d5a8d5;
            border: 2px solid #6a4a6a;
        }

        .other-month {
            background: var(--other-month-bg);
            color: var(--other-month-text);
        }

        .today {
            border: 3px solid var(--today-border);
            background: var(--today-bg);
            box-shadow: 0 0 15px rgba(255, 154, 158, 0.5);
        }

        .today::before {
            content: '🐕';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 12px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            padding: 20px;
            background: var(--bg-legend);
            border-radius: 20px;
            border: 2px solid var(--border-color);
            position: relative;
            transition: background 0.3s ease, border-color 0.3s ease;
        }


        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-work-1 {
            background: linear-gradient(135deg, #90EE90 0%, #98FB98 100%);
            border: 2px solid #32CD32;
        }

        .legend-work-2 {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border: 2px solid #FF8C00;
        }

        .legend-work-3 {
            background: linear-gradient(135deg, #FF6347 0%, #FF4500 100%);
            border: 2px solid #DC143C;
        }

        .legend-off {
            background: linear-gradient(135deg, #FFB6C1 0%, #FFC0CB 100%);
            border: 2px solid #DC143C;
        }

        /* Темная тема для легенды */
        [data-theme="dark"] .legend-work-1 {
            background: linear-gradient(135deg, #2d5a2d 0%, #3d6b3d 100%);
            border: 2px solid #4a7c4a;
        }

        [data-theme="dark"] .legend-work-2 {
            background: linear-gradient(135deg, #5a4a2d 0%, #6b5a3d 100%);
            border: 2px solid #7c6a4a;
        }

        [data-theme="dark"] .legend-work-3 {
            background: linear-gradient(135deg, #5a2d2d 0%, #6b3d3d 100%);
            border: 2px solid #7c4a4a;
        }

        [data-theme="dark"] .legend-off {
            background: linear-gradient(135deg, #4a2d4a 0%, #5a3d5a 100%);
            border: 2px solid #6a4a6a;
        }

        .info-panel {
            background: var(--bg-info);
            color: var(--text-secondary);
            padding: 20px;
            margin: 20px;
            border-radius: 20px;
            border-left: 5px solid #ff9a9e;
            position: relative;
            transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        /* Темная тема для info-panel */
        [data-theme="dark"] .info-panel {
            border-left: 5px solid #63b3ed;
        }


        .info-panel h3 {
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .info-panel p {
            color: var(--text-info);
            line-height: 1.6;
        }


        /* Мобильные устройства */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { margin: 0; border-radius: 10px; }
            .header { padding: 20px 15px; }
            .header h1 { font-size: 1.8em; }
            .header p { font-size: 1em; }
            .controls { flex-direction: column; gap: 15px; padding: 15px; }
            .date-input { width: 100%; max-width: 300px; }
            .btn { width: 100%; max-width: 200px; font-size: 14px; padding: 12px 20px; }
            .month-header { flex-direction: column; gap: 15px; padding: 0 10px; }
            .month-title { font-size: 1.4em; text-align: center; }
            .nav-btn { width: 100%; max-width: 150px; font-size: 14px; padding: 12px 15px; }
            .calendar-grid { gap: 1px; font-size: 12px; }
            .day-header { padding: 8px 4px; font-size: 11px; }
            .day { min-height: 50px; padding: 8px 4px; }
            .day-number { font-size: 14px; margin-bottom: 2px; }
            .day-status { font-size: 9px; padding: 2px 4px; border-radius: 8px; }
            .legend { flex-direction: column; gap: 10px; padding: 15px; margin: 15px; }
            .legend-item { justify-content: center; font-size: 14px; }
            .legend-color { width: 16px; height: 16px; }
            .info-panel { margin: 15px; padding: 15px; }
            .info-panel h3 { font-size: 1.2em; }
            .info-panel p { font-size: 14px; }
        }
        
        @media (max-width: 480px) {
            .header h1 { font-size: 1.5em; }
            .day { min-height: 45px; padding: 6px 2px; }
            .day-number { font-size: 12px; }
            .day-status { font-size: 8px; padding: 1px 3px; }
            .day-header { padding: 6px 2px; font-size: 10px; }
            .month-title { font-size: 1.2em; }
            .nav-btn { font-size: 12px; padding: 10px 12px; }
        }
        
        @media (max-width: 360px) {
            .calendar-grid { 
                gap: 0px; 
                overflow-x: auto; 
                -webkit-overflow-scrolling: touch;
                display: flex;
                flex-wrap: wrap;
            }
            .day { 
                min-width: 36px; 
                min-height: 28px; 
                padding: 1px; 
                flex: 1 1 calc(14.28% - 0.5px);
                max-width: calc(14.28% - 0.5px);
            }
            .day-header { 
                min-width: 36px; 
                padding: 2px 1px; 
                font-size: 7px; 
                flex: 1 1 calc(14.28% - 0.5px);
                max-width: calc(14.28% - 0.5px);
            }
            .day-number { font-size: 8px; margin-bottom: 1px; }
            .day-status { font-size: 4px; padding: 0px; }
        }
        
        @media (max-width: 320px) {
            .calendar-grid { 
                gap: 0px;
                display: flex;
                flex-wrap: wrap;
            }
            .day { 
                min-width: 32px; 
                min-height: 25px; 
                padding: 0px; 
                flex: 1 1 calc(14.28% - 0px);
                max-width: calc(14.28% - 0px);
            }
            .day-header { 
                min-width: 32px; 
                padding: 1px; 
                font-size: 6px; 
                flex: 1 1 calc(14.28% - 0px);
                max-width: calc(14.28% - 0px);
            }
            .day-number { font-size: 7px; margin-bottom: 0px; }
            .day-status { font-size: 3px; padding: 0px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🐰 График работы 3 через 1 🐹</h1>
            <p>Календарь для отслеживания рабочих и выходных дней 🐕</p>
        </div>

        <div class="controls">
            <label for="startDate">Дата начала работы:</label>
            <input type="date" id="startDate" class="date-input">
            <button onclick="generateCalendar()" class="btn">Показать календарь</button>
            <button onclick="setToday()" class="btn">Сегодня</button>
            <button onclick="resetDate()" class="btn btn-reset">Сбросить</button>
            <button onclick="toggleTheme()" class="btn theme-toggle" id="themeToggle">🌙 Темная тема</button>
        </div>

        <div class="info-panel">
            <h3>🐰 Как пользоваться</h3>
            <p>Выберите дату начала работы и нажмите "Показать календарь". Система автоматически рассчитает график 3 через 1 с тремя типами рабочих дней: <strong>ДНС</strong> (зеленый), <strong>ДНС + Какашка</strong> (оранжевый), <strong>Какашка</strong> (красный), затем выходной. <strong>Дата начала работы сохраняется автоматически и будет восстановлена при следующем открытии страницы.</strong></p>
        </div>

        <div class="calendar" id="calendar">
            <!-- Календарь будет сгенерирован здесь -->
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color legend-work-1"></div>
                <span>🐰 ДНС</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-work-2"></div>
                <span>🐹 ДНС + Какашка</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-work-3"></div>
                <span>🐕 Какашка</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-off"></div>
                <span>🏠 Выходной</span>
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let startWorkDate = "06.09.2025";

        // Утилиты
        function setToday() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            localStorage.setItem('workStartDate', today);
            generateCalendar();
        }

        function generateCalendar() {
            const startDateInput = document.getElementById('startDate').value;
            if (!startDateInput) return alert('Пожалуйста, выберите дату начала работы');
            
            startWorkDate = new Date(startDateInput);
            localStorage.setItem('workStartDate', startDateInput);
            currentDate = new Date(startWorkDate);
            renderCalendar();
        }

        // Кэш для ускорения
        let cachedElements = {};
        let todayString = new Date().toDateString();
        let isRendering = false; // Предотвращаем множественные вызовы
        
        function getCachedElement(id) {
            if (!cachedElements[id]) {
                cachedElements[id] = document.getElementById(id);
            }
            return cachedElements[id];
        }

        // Сброс кэша при обновлении DOM
        function clearCache() {
            cachedElements = {};
        }

        // Дебаунсинг для навигации
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Рендерим календарь (исправленная версия)
        function renderCalendar(animationType = 'fade', direction = 'right') {
            if (isRendering) return;
            isRendering = true;
            
            const calendar = document.getElementById('calendar');
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const startDay = new Date(firstDay);
            const dayOfWeek = firstDay.getDay();
            startDay.setDate(startDay.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));

            let html = `<div class="month-header">
                <button class="nav-btn" onclick="previousMonth()">← Предыдущий</button>
                <div class="month-title" id="monthTitle">${getMonthName(month)} ${year}</div>
                <button class="nav-btn" onclick="nextMonth()">Следующий →</button>
            </div><div class="calendar-grid" id="calendarGrid">`;

            // Заголовки дней
            ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'].forEach(day => {
                html += `<div class="day-header">${day}</div>`;
            });

            // Дни календаря
            const today = new Date();
            const todayStr = today.toDateString();
            
            for (let i = 0; i < 42; i++) {
                const currentDay = new Date(startDay);
                currentDay.setDate(startDay.getDate() + i);
                const isCurrentMonth = currentDay.getMonth() === month;
                const isToday = currentDay.toDateString() === todayStr;
                const workStatus = getWorkStatus(currentDay);

                let dayClass = 'day';
                if (!isCurrentMonth) dayClass += ' other-month';
                if (isToday) dayClass += ' today';

                let statusClass, statusText;
                if (workStatus.startsWith('work-')) {
                    const workType = workStatus.split('-')[1];
                    statusClass = `work-${workType}`;
                    statusText = workType === '1' ? 'ДНС' : workType === '2' ? 'ДНС+К' : 'Какашка';
                } else {
                    statusClass = 'off-day';
                    statusText = 'Выходной';
                }

                html += `<div class="${dayClass}">
                    <div class="day-number">${currentDay.getDate()}</div>
                    <div class="day-status ${statusClass}">${statusText}</div>
                </div>`;
            }

            calendar.innerHTML = html + '</div>';
            
            // Анимация
            setTimeout(() => {
                const grid = document.getElementById('calendarGrid');
                const title = document.getElementById('monthTitle');
                
                if (grid) {
                    if (animationType === 'slide') {
                        grid.classList.add(direction === 'right' ? 'calendar-slide-in-right' : 'calendar-slide-in-left');
                    } else if (animationType === 'fade') {
                        grid.classList.add('calendar-fade-in');
                    }
                }
                
                if (title) {
                    title.classList.add('month-title-update');
                    setTimeout(() => title.classList.remove('month-title-update'), 600);
                }
                
                isRendering = false;
            }, 50);
        }

        // Утилиты
        function getWorkStatus(date) {
            if (!startWorkDate) return 'off';
            const daysDiff = Math.floor((date - startWorkDate) / (1000 * 60 * 60 * 24));
            if (daysDiff < 0) return 'off';
            const cycle = daysDiff % 4;
            return cycle < 3 ? `work-${cycle + 1}` : 'off';
        }

        function getMonthName(month) {
            return ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь',
                    'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'][month];
        }

        function navigateMonth(direction) {
            const grid = document.getElementById('calendarGrid');
            if (grid) grid.classList.add(direction === 'left' ? 'calendar-slide-out-left' : 'calendar-slide-out-right');
            setTimeout(() => {
                currentDate.setMonth(currentDate.getMonth() + (direction === 'left' ? -1 : 1));
                renderCalendar('slide', direction);
            }, 300);
        }

        function previousMonth() { navigateMonth('left'); }
        function nextMonth() { navigateMonth('right'); }

        function resetDate() {
            if (confirm('Вы уверены, что хотите сбросить сохраненную дату начала работы?')) {
                localStorage.removeItem('workStartDate');
                setToday();
            }
        }

        function toggleTheme() {
            const body = document.body;
            const toggle = document.getElementById('themeToggle');
            const isDark = body.getAttribute('data-theme') === 'dark';
            
            if (isDark) {
                body.removeAttribute('data-theme');
                toggle.textContent = '🌙 Темная тема';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                toggle.textContent = '☀️ Светлая тема';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Инициализация
        window.onload = function() {
            const savedTheme = localStorage.getItem('theme');
            const savedDate = localStorage.getItem('workStartDate');
            
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                document.getElementById('themeToggle').textContent = '☀️ Светлая тема';
            }
            
            if (savedDate) {
                document.getElementById('startDate').value = savedDate;
                startWorkDate = new Date(savedDate);
                renderCalendar();
            } else {
                setToday();
            }
        };
    </script>
</body>
</html> 